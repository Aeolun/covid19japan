---
layout: base
---

<section id="kpi">
  <div id="kpi-active" data-tippy-content="Tooltip">
    <div class="diff">( +0 )</div>
    <div class="value"><div class="lds-dual-ring"></div></div>
    <div class="label" data-ja="既存感染者数">Active</div>
  </div>
  <div id="kpi-critical">
    <div class="diff">( +0 )</div>
    <div class="value"><div class="lds-dual-ring"></div></div>
    <div class="label" data-ja="重症者数">Critical</div>
  </div>
  <div id="kpi-deceased">
    <div class="diff">( +0 )</div>
    <div class="value"><div class="lds-dual-ring"></div></div>
    <div class="label" data-ja="死亡者数">Deaths</div>
  </div>
  <div id="kpi-tested">
    <div class="diff">( +0 )</div>
    <div class="value"><div class="lds-dual-ring"></div></div>
    <div class="label" data-ja="検査実施人数">Tested</div>
  </div>
  <div id="kpi-confirmed">
    <div class="diff">( +0 )</div>
    <div class="value"><div class="lds-dual-ring"></div></div>
    <div class="label" data-ja="感染者数">Confirmed</div>
  </div>
  <div id="kpi-recovered">
    <div class="diff">( +0 )</div>
    <div class="value"><div class="lds-dual-ring"></div></div>
    <div class="label" data-ja="回復者数">Recovered</div>
  </div>
</section>


<a name="map"></a>
<div class="center-offset">
  <h4>COVID-19 Outbreak Map</h4>
</div>
<section id="map-legend">
  <div><span class="one">▉</span> <span data-ja="1-10 件">1-10 cases</span></div>
  <div><span class="two">▉</span> <span data-ja="11-25 件">11-25 cases</span></div>
  <div><span class="three">▉</span> <span data-ja="26-50 件">26-50 cases</span></div>
  <div><span class="four">▉</span> <span data-ja="51+ 件">51+ cases</span></div>
</section>
<div id="map-container"></div>
<h5>powered by <a href="https://covid19japan.com" target=")blank">COVID19Japan.com</a></h5>

{% include footer.html %}

<!-- JS -->
{% include scripts.html %}
<script>
  (function(){
    document.body.classList.add('embed-mode')
    
    if(typeof drawMap === 'undefined'){
      return
    }
    
    drawMap()
    
    var styleLoaded = false
    var jsonData = undefined
    const FIVE_MINUTES_IN_MS = 300000
    var pageDraws = 0

    function whenMapAndDataReady(){
      if(!styleLoaded || !jsonData){
        return
      }
      
      drawMapPrefectures(pageDraws)
    }

    map.once('style.load', function(e) {
      styleLoaded = true
      whenMapAndDataReady()
    })

    function loadDataOnPage() {
      loadData(function (data) {
        jsonData = data

        ddb.prefectures = jsonData.prefectures
        let newTotals = calculateTotals(jsonData.daily)
        ddb.totals = newTotals[0]
        ddb.totalsDiff = newTotals[1]
        ddb.trend = jsonData.daily
        ddb.lastUpdated = jsonData.updated[0].lastupdated

        drawKpis(ddb.totals, ddb.totalsDiff)

        whenMapAndDataReady()
      })
    }

    loadDataOnPage()

    // Reload data every five minutes
    setInterval(function () {
      unDrawKpis()
      pageDraws++;
      jsonData = undefined;
      initDataTranslate()
      setTimeout(function () {
        loadDataOnPage()
      }, 1000)
    }, 300000)

  })()
</script>
